# Internationalization (i18n)

The project uses Mozilla Fluent for internationalization with support for English (en-US) and Japanese (ja-JP).

## Resource Resolution (Hybrid Approach)

Translations are loaded using a **hybrid strategy**: built-in embedded resources with external override support.

### Resolution order (per locale)

1. **External override** â€” `<data_dir>/ggg/locales/<locale>/`
2. **Embedded fallback** â€” resources compiled into the binary via `rust-embed`

Override granularity is **per-locale**: if the external directory contains a locale folder (e.g. `ja-JP/`) with at least one `.ftl` file, **all** translations for that locale are loaded from the external directory. Embedded resources are not merged.

### Platform-specific data directories

| Platform | Path                                          |
|----------|-----------------------------------------------|
| Linux    | `$XDG_DATA_HOME/ggg/locales/` (default: `~/.local/share/ggg/locales/`) |
| macOS    | `~/Library/Application Support/ggg/locales/`  |
| Windows  | `%APPDATA%\ggg\locales\`                      |

### Embedded locales

Currently only **en-US** is embedded as the built-in fallback. This guarantees the application always starts, even without external locale files.

To embed additional locales, add `#[include = "<locale>/*"]` entries to the `EmbeddedLocales` struct in `src/util/i18n.rs`.

## Translation File Structure

```
locales/
â”œâ”€â”€ en-US/
â”‚   â”œâ”€â”€ main.ftl       # App title, pane labels, status bar
â”‚   â”œâ”€â”€ help.ftl       # Help screen (~40 strings)
â”‚   â”œâ”€â”€ settings.ftl   # Settings labels & descriptions (~50 strings)
â”‚   â”œâ”€â”€ dialogs.ftl    # Dialog titles & prompts (~33 strings)
â”‚   â”œâ”€â”€ status.ftl     # Status messages & labels (~18 strings)
â”‚   â””â”€â”€ commands.ftl   # Command response messages (~18 strings)
â””â”€â”€ ja-JP/
    â””â”€â”€ (same structure)
```

**Key translation prefixes:**
- `pane-*` - Pane titles (folders, downloads, history, details)
- `tree-*` - Folder tree labels (completed-node)
- `status-*` - Download status labels (pending, downloading, deleted, etc.)
- `cmd-*` - Command response messages (errors, success)

## Adding New Translation Strings

1. **Add keys to all .ftl files** in both `locales/en-US/` and `locales/ja-JP/`
2. **Use naming convention:** `{section}-{context}-{element}`
   - Examples: `help-section-primary`, `settings-app-max-concurrent`, `dialog-add-download`
3. **Simple strings:** Use `app.state.t("key")`
   ```rust
   let title = app.state.t("dialog-help");
   ```
4. **With variables:** Use `app.state.t_with_args("key", Some(&fluent_args!{...}))`
   ```rust
   use fluent::fluent_args;
   let args = fluent_args! {
       "label" => field.label(),
   };
   let title = app.state.t_with_args("dialog-edit-label", Some(&args));
   ```

## Adding New Languages

1. Create `locales/{locale}/` directory (e.g., `locales/zh-CN/`)
2. Copy all `.ftl` files from `en-US` as template
3. Translate all strings to target language
4. Update `src/util/i18n.rs` locale mapping if needed
5. Add language code validation in `src/tui/app.rs` (Language setting handler)
6. Update documentation (README.md, Config.md)

### Embedding a new locale in the binary

To include a new locale in the compiled binary (so it works without external files):

1. Add `#[include = "<locale>/*"]` to the `EmbeddedLocales` struct in `src/util/i18n.rs`
2. Rebuild the project

Example â€” embedding ja-JP alongside en-US:
```rust
#[derive(RustEmbed)]
#[folder = "locales/"]
#[include = "en-US/*"]
#[include = "ja-JP/*"]
struct EmbeddedLocales;
```

## Overriding Translations (End User)

Users can override or add translations without rebuilding:

1. Create the locale directory in the platform data path:
   - Linux: `mkdir -p ~/.local/share/ggg/locales/ja-JP`
   - macOS: `mkdir -p ~/Library/Application\ Support/ggg/locales/ja-JP`
   - Windows: create `%APPDATA%\ggg\locales\ja-JP\`
2. Place `.ftl` files in the directory
3. Restart the application

**Important:** When overriding a locale, provide **all** `.ftl` files for that locale. Partial overrides are not supported â€” the external directory fully replaces the embedded resources for that locale.

## Translation Best Practices

- **Keep keys descriptive** - `status-downloading` not `st-dl`
- **Group related keys** - Use consistent prefixes (e.g., all help keys start with `help-`)
- **Include context** - `dialog-add-download` vs generic `add-download`
- **Preserve formatting** - Emojis and special characters (ðŸ“‹, âœ…) are part of the design
- **Test both languages** - Always verify translations display correctly in the TUI
- **Don't translate code** - Comments and code should remain in English
